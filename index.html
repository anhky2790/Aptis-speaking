<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>English Speaking Coach</title>
  <style>
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background-color:#f0f2f5;margin:0;padding:20px;display:flex;justify-content:center;align-items:flex-start;min-height:100vh}
    .container{width:100%;max-width:700px;background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.08);display:flex;flex-direction:column;gap:25px}
    h1{font-size:2.2em;color:#333;text-align:center;margin:0;font-weight:600}
    .subtitle{font-size:1em;color:#666;text-align:center;margin-top:5px}
    .section{display:flex;flex-direction:column;gap:15px}
    .section-heading{font-size:1.2em;color:#555;border-bottom:2px solid #e0e0e0;padding-bottom:8px;margin-bottom:5px;font-weight:500}
    label{font-weight:600;color:#444;margin-bottom:5px}
    #question,#suggestedAnswer{font-size:1.2em;line-height:1.6;padding:15px;border:1px solid #ddd;border-radius:8px;transition:border-color .3s,box-shadow .3s;background-color:#f9f9f9;min-height:100px;resize:vertical}
    input[type=text],textarea,select{width:100%;padding:12px;border:1px solid #ddd;border-radius:8px;font-size:1em;transition:border-color .3s,box-shadow .3s;background-color:#f9f9f9}
    input[type=text]:focus,textarea:focus,select:focus{border-color:#007bff;box-shadow:0 0 0 3px rgba(0,123,255,.15);outline:none}
    .controls,.player-controls{display:flex;flex-wrap:wrap;gap:10px;justify-content:center}
    button{padding:12px 20px;background-color:#007bff;color:#fff;border:none;border-radius:8px;font-size:1em;cursor:pointer;transition:background-color .3s,transform .2s;font-weight:600;display:flex;align-items:center;gap:8px}
    button:hover{background-color:#0056b3;transform:translateY(-2px)}
    button:disabled{background-color:#ccc;cursor:not-allowed;transform:none}
    .timer{position:fixed;top:20px;right:20px;font-size:2.5em;font-weight:700;color:#ff4d4d;background:#fff;padding:10px 15px;border-radius:10px;box-shadow:0 4px 15px rgba(0,0,0,.1);letter-spacing:2px;z-index:1000}
    .settings{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;align-items:center}
    .settings-item{display:flex;flex-direction:column;gap:5px}
    .range-container{display:flex;align-items:center;gap:10px}
    input[type=range]{-webkit-appearance:none;width:100%;height:8px;background:#e0e0e0;border-radius:5px;outline:none;cursor:pointer}
    input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;background:#007bff;border-radius:50%;cursor:pointer;border:2px solid #fff;box-shadow:0 0 5px rgba(0,0,0,.2)}
    .range-value{min-width:30px;text-align:right;font-weight:600;color:#555}
    .recordings{display:flex;flex-direction:column;gap:15px}
    .recording-item{display:flex;align-items:center;gap:15px;padding:10px;border:1px solid #eee;border-radius:8px;background-color:#fafafa}
    .recording-item a{color:#007bff;text-decoration:none;font-weight:500}
    .recording-item a:hover{text-decoration:underline}
    @media (max-width:600px){.container{padding:20px}.settings{grid-template-columns:1fr}.controls button{flex:1 1 auto;justify-content:center}.timer{font-size:2em;padding:8px 12px;top:10px;right:10px}}
  </style>
</head>
<body>
  <div class="container">
    <h1>English Speaking Coach üó£Ô∏è</h1>
    <p class="subtitle"> APTIS SPEAKING PART 1: Q&A, ƒë·∫øm ng∆∞·ª£c, ghi √¢m & ph√°t l·∫°i, transcript tr·ª±c ti·∫øp</p>

    <div class="section">
      <h2 class="section-heading">C√¢u h·ªèi & Tr·∫£ l·ªùi</h2>

      <label for="topicSelect">Ch·ªß ƒë·ªÅ</label>
      <select id="topicSelect"></select>

      <label for="questionSelect">C√¢u h·ªèi</label>
      <!-- ‚ñº Select ƒë·ªÉ CH·ªåN c√¢u h·ªèi, c√≥ m≈©i t√™n gi·ªëng Ch·ªß ƒë·ªÅ -->
      <select id="questionSelect"></select>
      <button id="loadQuestion">T·∫£i c√¢u h·ªèi ng·∫´u nhi√™n</button>

      <label for="question">N·ªôi dung c√¢u h·ªèi</label>
      <textarea id="question" readonly></textarea>
      <div class="player-controls">
        <button id="playQuestion">üîä Ph√°t c√¢u h·ªèi</button>
      </div>

      <label for="suggestedAnswer">G·ª£i √Ω c√¢u tr·∫£ l·ªùi</label>
      <textarea id="suggestedAnswer" readonly></textarea>
      <div class="player-controls">
        <button id="playSuggested">üîä Ph√°t g·ª£i √Ω</button>
      </div>
      <p style="text-align:center;color:#888;font-style:italic">M·∫πo: B·∫°n tr·∫£ l·ªùi theo √Ω m√¨nh, kh√¥ng c·∫ßn ƒë·ªçc theo g·ª£i √Ω.</p>
    </div>

    <div class="section">
      <h2 class="section-heading">Phi√™n luy·ªán t·∫≠p c·ªßa b·∫°n</h2>
      <div class="timer" id="timer">00:30</div>
      <div class="controls">
        <button id="startRecording">üéôÔ∏è B·∫Øt ƒë·∫ßu</button>
        <button id="stopRecording" disabled>‚èπ D·ª´ng</button>
        <button id="clearTranscript">üßπ X√≥a transcript</button>
        <button id="playLastRecording">‚èØÔ∏è Ph√°t b·∫£n ghi cu·ªëi</button>
      </div>
      <label for="transcript">T√¥i n√≥i (ghi theo th·ªùi gian th·ª±c)</label>
      <textarea id="transcript" readonly></textarea>
    </div>

    <div class="section">
      <h2 class="section-heading">C√†i ƒë·∫∑t ph√°t √¢m</h2>
      <div class="settings">
        <div class="settings-item">
          <label for="voiceSelect">Gi·ªçng</label>
          <select id="voiceSelect"></select>
        </div>
        <div class="settings-item">
          <label for="rate">T·ªëc ƒë·ªô</label>
          <div class="range-container"><input type="range" id="rate" min="0.5" max="2" step="0.1" value="1"><span class="range-value" id="rateValue">1.0</span></div>
        </div>
        <div class="settings-item">
          <label for="pitch">Cao ƒë·ªô</label>
          <div class="range-container"><input type="range" id="pitch" min="0.5" max="2" step="0.1" value="1"><span class="range-value" id="pitchValue">1.0</span></div>
        </div>
      </div>
    </div>

    <div class="section recordings">
      <h2 class="section-heading">B·∫£n ghi g·∫ßn ƒë√¢y</h2>
      <p style="font-size:.9em;color:#888;margin-top:-10px">L∆∞u c·ª•c b·ªô trong phi√™n n√†y. B·∫°n c√≥ th·ªÉ t·∫£i v·ªÅ.</p>
      <div id="recordingList"></div>
    </div>
  </div>

  <script>
    // ====== d·ªØ li·ªáu c√¢u h·ªèi (GI·ªÆ NGUY√äN N·ªòI DUNG C·ª¶A B·∫†N) ======
    const questionsData = {
      "ACTIVITY/HOBBY": 
	  [   
  {
    "question": "Please describe your typical day.",
    "answer": "I usually start my day by listening to music because it helps me relax and feel happy. Moreover, I spend time reading books because it helps me learn new things and improve my vocabulary. Furthermore, I often go shopping because it helps me buy fresh food and clothes for my family."
  },
  {
    "question": "Describe something you are planning to do in the future.",
    "answer": "I am planning to study English in the future because it will help me communicate with foreigners and get a good job. Moreover, I want to study Chinese because it will help me understand Chinese culture and do business. Furthermore, I would like to work for a famous company because it will give me experience and a high salary."
  },
  {
    "question": "Tell me about your today.",
    "answer": "Today I listened to music and read books all day. I like listening to music because it makes me relaxed after studying. Moreover, I enjoy reading books because it gives me more knowledge. Furthermore, I like playing computer games because it helps me have fun and reduce stress."
  },
  {
    "question": "What‚Äôs your favorite color?",
    "answer": "I like red because it makes me feel energetic and confident. Moreover, I like blue because it helps me feel calm and peaceful. Furthermore, I like green because it makes me feel fresh and close to nature."
  },
  {
    "question": "Please tell me about your favorite book.",
    "answer": "My favorite book is by Nguyen Nhat Anh. I like reading this book because it tells touching and meaningful stories. Moreover, I enjoy reading novels because they help me imagine different worlds. Furthermore, I like reading comic books because they are funny and relaxing."
  },
  {
    "question": "What types of books do people like to read?",
    "answer": "I think people like reading novels and comic books because they are entertaining and relaxing. For me, I like reading books because they help me learn more knowledge. Moreover, I like reading novels because they improve my imagination. Furthermore, I like reading comic books because they make me laugh."
  },
  {
    "question": "Which kind of sports do people in your country like most?",
    "answer": "People in my country like football most because it helps them stay healthy and have fun. Sometimes they also like playing table tennis because it helps them relax and improve their reflexes."
  },
  {
    "question": "Which kind of sports do you like most?",
    "answer": "For me, I like playing football because it helps me exercise and make friends. Moreover, I also like playing table tennis because it improves my reflexes and concentration."
  },
  {
    "question": "What are you going to do for the rest of today?",
    "answer": "I think I will study English for the rest of today because it helps me improve my communication skills. Moreover, I will listen to music in the evening because it helps me relax after studying."
  },
  {
    "question": "What did you do yesterday?",
    "answer": "I played computer games yesterday because they help me have fun. Moreover, I read books yesterday because they help me learn more. Furthermore, I went shopping yesterday because it helps me buy the things I need."
  },
  {
    "question": "How do you like to spend your holidays or vacations?",
    "answer": "I like listening to music on my holidays because it helps me relax. Moreover, I like reading books because it helps me learn more knowledge. Furthermore, I like going shopping because it helps me buy nice clothes. In addition, I like travelling to Hanoi because it helps me explore new places."
  },
  {
    "question": "How often do you watch TV?",
    "answer": "I watch TV every day in the evening because it helps me relax. Moreover, I like watching TV with my friends because we can share funny moments. Furthermore, I like watching TV with my family because it helps us spend time together."
  },
  {
    "question": "What do you like to do with your friends?",
    "answer": "I like watching TV with my friends because we can talk about the shows. Moreover, I like going shopping with my friends because we can choose clothes together. Furthermore, I like playing football with my friends because it is fun and healthy."
  }
  ],
  
  "OTHER question": 
  [
  {
    "question": "Tell me about the last lesson in class.",
    "answer": "The last lesson in my class was last week. I studied English with my classmates. We learnt listening, reading, speaking, and writing. I like learning English because it helps me communicate with people around the world. Moreover, I like learning science because it helps me understand how things work. Furthermore, I like learning math because it helps me solve problems quickly."
  },
  {
    "question": "Describe a typical meal in your country.",
    "answer": "People in my country often have three meals a day with their family. I like having meals with my family because it helps us talk and share stories. Moreover, I like having meals with my friends because it is fun and relaxing. Furthermore, I like having meals with my girlfriend/boyfriend because it is romantic. In addition, I like having meals at restaurants because I can try new dishes."
  },
  {
    "question": "What is the special meal in your country?",
    "answer": "My country has many special meals. We often have special meals during Tet holiday, birthday parties, and wedding parties. I like having special meals because they make me happy. Moreover, I like eating Banh Chung during Tet because it is delicious and traditional. Furthermore, I like having special meals at birthday or wedding parties because they are joyful."
  },
  {
    "question": "Tell me about yourself and what you are looking for in your new house.",
    "answer": "I am a student now and I am very busy. I study English all day. I like studying English because it helps me get a good job. I am looking for a big house with a big living room, a big kitchen, a big bedroom, and a big garden. I like a big house because it is comfortable and beautiful."
  },
  {
    "question": "What is your occupation / job / career?",
    "answer": "I am a student now and I am very busy. I have to study English all day. I like studying English because it helps me improve my skills. I also like listening to music because it helps me relax. Moreover, I like reading books because it gives me more knowledge. Furthermore, I like going shopping because it is fun."
  },
  {
    "question": "What are you wearing today?",
    "answer": "I am wearing a T-shirt and jeans today. I like wearing a T-shirt because it is comfortable. Moreover, I like wearing jeans because they are easy to match with clothes."
  },
  {
    "question": "What is the importance of sleep?",
    "answer": "Sleep is important because it helps us stay healthy and feel fresh. I like sleeping because it gives me energy for the next day. Moreover, I like reading books before sleeping because it helps me relax. Furthermore, I like listening to music before sleeping because it makes me sleep better."
  },
  {
    "question": "How‚Äôs the weather today?",
    "answer": "The weather is very hot today, and I am reading a book. I like travelling to Hanoi because it helps me explore new places. Moreover, I like reading books because they improve my knowledge. Furthermore, I like listening to music because it makes me feel relaxed."
  },
  {
    "question": "Tell me why you are learning English.",
    "answer": "I like learning English because it helps me travel and work anywhere in the world. Moreover, I also like learning Chinese because it helps me understand Chinese culture. Furthermore, I also like learning Japanese because it helps me connect with Japanese friends."
  },
  {
    "question": "When do you feel tired?",
    "answer": "I am a student now, and I feel tired when I have to study English a lot. However, I like studying English because it improves my communication. Moreover, I also like learning Chinese because it is interesting. Furthermore, I also like learning Japanese because it is useful."
  },
  {
    "question": "Please tell me about one of your good memories.",
    "answer": "Last year, I visited Sapa with my love. Sapa is really beautiful and has many great views. This is one of my good memories. I really like travelling to Sapa because it helps me relax and enjoy nature. I really like visiting Sapa with my friends because we have fun together."
  }
],
  
   "PERSON": 
  [
    {
    "question": "Please tell me about your best friend.",
    "answer": "My best friend is Nguyen Hoang Thanh. He is 20 years old and really handsome. We like listening to music together because it makes us relaxed. Moreover, we like reading books together because it helps us learn more. Furthermore, we like watching films together because it is fun and entertaining."
  },
  {
    "question": "Tell me about your family.",
    "answer": "There are four people in my family: my parents, my brother, and me. We like listening to music together because it helps us feel happy. Moreover, we like reading books together because it helps us gain more knowledge. Furthermore, we like watching films together because it helps us spend time together."
  },
  {
    "question": "Please tell me about your favorite film star / singer.",
    "answer": "My favorite singer is Gia Bao. She is beautiful and really famous in Vietnam. I really like listening to her songs because they are emotional and inspiring. Moreover, I like watching her music videos because they are creative and beautiful."
  },
  {
    "question": "Tell me about a movie you watched.",
    "answer": "The movie I watched was ‚ÄúMai‚Äù. This film is really interesting and nice. I like watching the film ‚ÄúMai‚Äù at the cinema because the sound and picture are amazing. Moreover, I like watching the film ‚ÄúMai‚Äù with my friends because we can talk about it after. Furthermore, I like watching the film ‚ÄúMai‚Äù with my family because it helps us relax together."
  },
  {
    "question": "Tell me the last thing you saw on TV last night.",
    "answer": "The last thing I saw on TV last night was the film ‚ÄúMai‚Äù. This film is really interesting and nice. I like watching the film ‚ÄúMai‚Äù at the cinema because it feels more exciting. Moreover, I like watching the film ‚ÄúMai‚Äù with my friends because it is more fun. Furthermore, I like watching the film ‚ÄúMai‚Äù with my family because it helps us enjoy time together."
  },
  {
    "question": "Tell me about a time you watched a film.",
    "answer": "Last week I went to Thai Nguyen cinema to watch the film ‚ÄúDao, Pho and Piano‚Äù. This film is really interesting and nice. I like watching films at the cinema because the screen is big and the sound is great. Moreover, I like watching films with my friends at the cinema because we have fun together. Furthermore, I like watching films with my family at the cinema because it makes us happy."
  },
  {
    "question": "Tell me about the last time you went to the cinema.",
    "answer": "The last time I went to the cinema was last week. I went there to watch the film ‚ÄúMai‚Äù. This film is really interesting and nice. I like watching the film ‚ÄúMai‚Äù at the cinema because the atmosphere is exciting. Moreover, I like watching the film ‚ÄúMai‚Äù with my friends because it is more enjoyable. Furthermore, I like watching the film ‚ÄúMai‚Äù with my family because it is a nice family activity."
  }
  ],
  
  "PLACES/CITY": 
  [     
  {
    "question": "Please tell me about a famous place in your country.",
    "answer": "Hanoi is a famous place in my country. People in Hanoi are friendly and nice. I like visiting Hanoi because it helps me learn about Vietnamese history and culture. Moreover, I like visiting Danang because it has beautiful beaches and fresh air. Furthermore, I like visiting Ho Chi Minh City because it is modern and exciting."
  },
  {
    "question": "Tell me about your favorite place.",
    "answer": "My favorite place is Hanoi. People in Hanoi are friendly and nice. I like visiting Hanoi because it helps me enjoy delicious food and historical sites. Moreover, I like visiting Danang because it is peaceful and has beautiful beaches. Furthermore, I like visiting Ho Chi Minh City because it has many interesting places to explore."
  },
  {
    "question": "Describe the place where you live / Tell me about your hometown or city.",
    "answer": "I live in Hanoi. People in Hanoi are friendly and nice. I like living in Hanoi because it has many cultural activities and good food. Moreover, I like living in Danang because it is quiet and clean. Furthermore, I like living in Ho Chi Minh City because it has many job opportunities."
  },
  {
    "question": "Tell me about your last holiday.",
    "answer": "Last summer, I visited Hanoi, a famous place in my country. People in Hanoi are friendly and nice. I like visiting Hanoi because it has many interesting museums. Moreover, I like visiting Danang because it is relaxing and beautiful. Furthermore, I like visiting Ho Chi Minh City because it has many shopping centers."
  },
  {
    "question": "Please tell me the best way to travel around your country.",
    "answer": "The best way to travel around my country is by car. I like travelling by car because it is comfortable and fast. Moreover, I like travelling by bike because it is cheap and healthy. Furthermore, I like travelling by bus because it is safe and affordable."
  },
  {
    "question": "Please describe your journey here today.",
    "answer": "I am travelling to Danang, which is really famous. People in Danang are friendly and nice. I came here by bike. I like travelling to Danang by bike because it is fun and I can enjoy the scenery. Moreover, I like travelling to Danang by car because it is comfortable. Furthermore, I like travelling to Danang by bus because it is safe and cheap."
  },
  {
    "question": "Tell me about your first school.",
    "answer": "My first school is Chu Van An. There were many students and teachers in my school in the past and now. I like visiting my first school in my free time because it brings back good memories. Moreover, I like visiting my friends at my first school because we can talk about old times. Furthermore, I like visiting my teachers at my first school because they taught me a lot."
  },
  {
    "question": "Describe this room / Describe the room you are in.",
    "answer": "I am staying in the living room of my house. There is a TV and a big table in my living room. I like listening to music in my living room because it helps me relax. Moreover, I like reading books in my living room because it is quiet. Furthermore, I like watching films in my living room because it is comfortable."
  }
  ]
    };

    // ====== KH·ªûI T·∫†O UI ======
    function populateUI(){
      const topicSelect=document.getElementById('topicSelect');
      topicSelect.innerHTML='';
      Object.keys(questionsData).forEach(t=>{const o=document.createElement('option');o.value=t;o.textContent=t;topicSelect.appendChild(o)});
      topicSelect.addEventListener('change',()=>{buildQuestionSelect();applySelectedQuestion()});
      document.getElementById('questionSelect').addEventListener('change',applySelectedQuestion);
      document.getElementById('loadQuestion').addEventListener('click',loadRandomQuestion);
      // L·∫ßn ƒë·∫ßu
      buildQuestionSelect();
      applySelectedQuestion();
    }

    // T·∫°o danh s√°ch <option> cho select c√¢u h·ªèi (c√≥ m≈©i t√™n)
    function buildQuestionSelect(){
      const topic=document.getElementById('topicSelect').value;
      const qs=questionsData[topic]||[];
      const sel=document.getElementById('questionSelect');
      sel.innerHTML='';
      qs.forEach((item,idx)=>{const op=document.createElement('option');op.value=String(idx);op.textContent=`${idx+1}. ${item.question}`;sel.appendChild(op)});
      // Gi·ªØ ch·ªçn ph·∫ßn t·ª≠ ƒë·∫ßu n·∫øu t·ªìn t·∫°i
      if(qs.length>0) sel.value='0';
    }

    // √Åp d·ª•ng c√¢u h·ªèi theo option ƒëang ch·ªçn
    function applySelectedQuestion(){
      const topic=document.getElementById('topicSelect').value;
      const qs=questionsData[topic]||[];
      const selIdx=parseInt(document.getElementById('questionSelect').value||'0',10)||0;
      const item=qs[Math.min(Math.max(selIdx,0),Math.max(qs.length-1,0))];
      if(!item) return;
      document.getElementById('question').value=item.question;
      document.getElementById('suggestedAnswer').value=item.answer;
    }

    // L·∫•y ng·∫´u nhi√™n nh∆∞ng v·∫´n c·∫≠p nh·∫≠t select ƒë·ªÉ ƒë·ªìng b·ªô
    function loadRandomQuestion(){
      const topic=document.getElementById('topicSelect').value;
      const qs=questionsData[topic]||[];
      if(!qs.length) return;
      const idx=Math.floor(Math.random()*qs.length);
      document.getElementById('questionSelect').value=String(idx);
      applySelectedQuestion();
    }

    document.addEventListener('DOMContentLoaded', populateUI);

    // ====== TTS ======
    const synth=window.speechSynthesis; let voices=[];
    function populateVoiceList(){
      voices=synth.getVoices();
      const voiceSelect=document.getElementById('voiceSelect');
      voiceSelect.innerHTML='';
      voices.forEach(v=>{if(v.lang.startsWith('en')){const op=document.createElement('option');op.value=v.name;op.textContent=`${v.name} (${v.lang})`;voiceSelect.appendChild(op);}});
      const def=voices.find(v=>v.lang==='en-US'); if(def) voiceSelect.value=def.name;
    }
    populateVoiceList(); if(synth.onvoiceschanged!==undefined) synth.onvoiceschanged=populateVoiceList;
    document.getElementById('rate').addEventListener('input',e=>document.getElementById('rateValue').textContent=e.target.value);
    document.getElementById('pitch').addEventListener('input',e=>document.getElementById('pitchValue').textContent=e.target.value);
    function speak(text){const u=new SpeechSynthesisUtterance(text);const sel=document.getElementById('voiceSelect').value;const v=voices.find(v=>v.name===sel);if(v)u.voice=v;u.rate=parseFloat(document.getElementById('rate').value);u.pitch=parseFloat(document.getElementById('pitch').value);synth.speak(u);}
    document.getElementById('playQuestion').addEventListener('click',()=>speak(document.getElementById('question').value));
    document.getElementById('playSuggested').addEventListener('click',()=>speak(document.getElementById('suggestedAnswer').value));

    // ====== Ghi √¢m + transcript (gi·ªØ nguy√™n logic c≈©) ======
    let recognition; let mediaRecorder; let audioChunks=[]; let recordings=[]; let currentAudio=null; let timerInterval; let timeLeft=30; const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;

    document.getElementById('startRecording').addEventListener('click', async()=>{
      try{
        const stream=await navigator.mediaDevices.getUserMedia({audio:true});
        mediaRecorder=new MediaRecorder(stream); audioChunks=[];
        mediaRecorder.ondataavailable=e=>audioChunks.push(e.data);
        mediaRecorder.onstop=()=>{const blob=new Blob(audioChunks,{type:'audio/webm'});recordings.push(blob);updateRecordingList();};
        mediaRecorder.start();
        document.getElementById('startRecording').disabled=true;document.getElementById('stopRecording').disabled=false;
        timeLeft=30; document.getElementById('timer').textContent='00:30'; timerInterval=setInterval(updateTimer,1000);
        if(SpeechRecognition){
          recognition=new SpeechRecognition(); recognition.lang='en-US'; recognition.interimResults=true;
          recognition.onresult=e=>{const t=Array.from(e.results).map(r=>r[0].transcript).join(''); document.getElementById('transcript').value=t;};
          recognition.onerror=e=>console.error('Speech recognition error',e);
          recognition.start();
        }
      }catch(err){console.error('Error accessing microphone',err); alert('Kh√¥ng th·ªÉ truy c·∫≠p microphone. Vui l√≤ng ki·ªÉm tra quy·ªÅn v√† th·ª≠ l·∫°i.');}
    });

    document.getElementById('stopRecording').addEventListener('click',()=>{
      if(mediaRecorder&&mediaRecorder.state!=='inactive') mediaRecorder.stop();
      if(recognition) recognition.stop();
      clearInterval(timerInterval);
      document.getElementById('startRecording').disabled=false;document.getElementById('stopRecording').disabled=true;
    });

    document.getElementById('clearTranscript').addEventListener('click',()=>document.getElementById('transcript').value='');
    document.getElementById('playLastRecording').addEventListener('click',()=>{
      if(recordings.length>0){const last=recordings[recordings.length-1]; if(currentAudio) currentAudio.pause(); currentAudio=new Audio(URL.createObjectURL(last)); currentAudio.play();} else {alert('Ch∆∞a c√≥ b·∫£n ghi n√†o.');}
    });

    function updateTimer(){ timeLeft--; document.getElementById('timer').textContent=`00:${timeLeft.toString().padStart(2,'0')}`; if(timeLeft<=0 && !document.getElementById('stopRecording').disabled){ document.getElementById('stopRecording').click(); } }

    function updateRecordingList(){ const list=document.getElementById('recordingList'); list.innerHTML=''; recordings.forEach((blob,i)=>{const div=document.createElement('div'); div.className='recording-item'; const audio=document.createElement('audio'); audio.controls=true; audio.src=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=audio.src; a.download=`recording_${i+1}.webm`; a.textContent='T·∫£i v·ªÅ'; div.appendChild(audio); div.appendChild(a); list.appendChild(div); }); }
  </script>
</body>
</html>
