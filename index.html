<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>English Speaking Coach</title>
  <style>
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background-color:#f0f2f5;margin:0;padding:20px;display:flex;justify-content:center;align-items:flex-start;min-height:100vh}
    .container{width:100%;max-width:700px;background:#fff;padding:30px;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.08);display:flex;flex-direction:column;gap:25px}
    h1{font-size:2.2em;color:#333;text-align:center;margin:0;font-weight:600}
    .subtitle{font-size:1em;color:#666;text-align:center;margin-top:5px}
    .section{display:flex;flex-direction:column;gap:15px}
    .section-heading{font-size:1.2em;color:#555;border-bottom:2px solid #e0e0e0;padding-bottom:8px;margin-bottom:5px;font-weight:500}
    label{font-weight:600;color:#444;margin-bottom:5px}
    #question,#suggestedAnswer{font-size:1.2em;line-height:1.6;padding:15px;border:1px solid #ddd;border-radius:8px;transition:border-color .3s,box-shadow .3s;background-color:#f9f9f9;min-height:100px;resize:vertical}
    input[type=text],textarea,select{width:100%;padding:12px;border:1px solid #ddd;border-radius:8px;font-size:1em;transition:border-color .3s,box-shadow .3s;background-color:#f9f9f9}
    input[type=text]:focus,textarea:focus,select:focus{border-color:#007bff;box-shadow:0 0 0 3px rgba(0,123,255,.15);outline:none}
    .controls,.player-controls{display:flex;flex-wrap:wrap;gap:10px;justify-content:center}
    button{padding:12px 20px;background-color:#007bff;color:#fff;border:none;border-radius:8px;font-size:1em;cursor:pointer;transition:background-color .3s,transform .2s;font-weight:600;display:flex;align-items:center;gap:8px}
    button:hover{background-color:#0056b3;transform:translateY(-2px)}
    button:disabled{background-color:#ccc;cursor:not-allowed;transform:none}
    .timer{position:fixed;top:20px;right:20px;font-size:2.5em;font-weight:700;color:#ff4d4d;background:#fff;padding:10px 15px;border-radius:10px;box-shadow:0 4px 15px rgba(0,0,0,.1);letter-spacing:2px;z-index:1000}
    .settings{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;align-items:center}
    .settings-item{display:flex;flex-direction:column;gap:5px}
    .range-container{display:flex;align-items:center;gap:10px}
    input[type=range]{-webkit-appearance:none;width:100%;height:8px;background:#e0e0e0;border-radius:5px;outline:none;cursor:pointer}
    input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;background:#007bff;border-radius:50%;cursor:pointer;border:2px solid #fff;box-shadow:0 0 5px rgba(0,0,0,.2)}
    .range-value{min-width:30px;text-align:right;font-weight:600;color:#555}
    .recordings{display:flex;flex-direction:column;gap:15px}
    .recording-item{display:flex;align-items:center;gap:15px;padding:10px;border:1px solid #eee;border-radius:8px;background-color:#fafafa}
    .recording-item a{color:#007bff;text-decoration:none;font-weight:500}
    .recording-item a:hover{text-decoration:underline}
    @media (max-width:600px){.container{padding:20px}.settings{grid-template-columns:1fr}.controls button{flex:1 1 auto;justify-content:center}.timer{font-size:2em;padding:8px 12px;top:10px;right:10px}}
  </style>
</head>
<body>
  <div class="container">
    <h1>English Speaking Coach üó£Ô∏è</h1>
    <p class="subtitle">B·∫£n ƒë·ªôc l·∫≠p ‚Äì Q&A, ƒë·∫øm ng∆∞·ª£c, ghi √¢m & ph√°t l·∫°i, transcript tr·ª±c ti·∫øp</p>

    <div class="section">
      <h2 class="section-heading">C√¢u h·ªèi & Tr·∫£ l·ªùi</h2>

      <label for="topicSelect">Ch·ªß ƒë·ªÅ</label>
      <select id="topicSelect"></select>

      <label for="questionSelect">C√¢u h·ªèi</label>
      <!-- ‚ñº Select ƒë·ªÉ CH·ªåN c√¢u h·ªèi, c√≥ m≈©i t√™n gi·ªëng Ch·ªß ƒë·ªÅ -->
      <select id="questionSelect"></select>
      <button id="loadQuestion">T·∫£i c√¢u h·ªèi ng·∫´u nhi√™n</button>

      <label for="question">N·ªôi dung c√¢u h·ªèi</label>
      <textarea id="question" readonly></textarea>
      <div class="player-controls">
        <button id="playQuestion">üîä Ph√°t c√¢u h·ªèi</button>
      </div>

      <label for="suggestedAnswer">G·ª£i √Ω c√¢u tr·∫£ l·ªùi</label>
      <textarea id="suggestedAnswer" readonly></textarea>
      <div class="player-controls">
        <button id="playSuggested">üîä Ph√°t g·ª£i √Ω</button>
      </div>
      <p style="text-align:center;color:#888;font-style:italic">M·∫πo: B·∫°n tr·∫£ l·ªùi theo √Ω m√¨nh, kh√¥ng c·∫ßn ƒë·ªçc theo g·ª£i √Ω.</p>
    </div>

    <div class="section">
      <h2 class="section-heading">Phi√™n luy·ªán t·∫≠p c·ªßa b·∫°n</h2>
      <div class="timer" id="timer">00:30</div>
      <div class="controls">
        <button id="startRecording">üéôÔ∏è B·∫Øt ƒë·∫ßu</button>
        <button id="stopRecording" disabled>‚èπ D·ª´ng</button>
        <button id="clearTranscript">üßπ X√≥a transcript</button>
        <button id="playLastRecording">‚èØÔ∏è Ph√°t b·∫£n ghi cu·ªëi</button>
      </div>
      <label for="transcript">T√¥i n√≥i (ghi theo th·ªùi gian th·ª±c)</label>
      <textarea id="transcript" readonly></textarea>
    </div>

    <div class="section">
      <h2 class="section-heading">C√†i ƒë·∫∑t ph√°t √¢m</h2>
      <div class="settings">
        <div class="settings-item">
          <label for="voiceSelect">Gi·ªçng</label>
          <select id="voiceSelect"></select>
        </div>
        <div class="settings-item">
          <label for="rate">T·ªëc ƒë·ªô</label>
          <div class="range-container"><input type="range" id="rate" min="0.5" max="2" step="0.1" value="1"><span class="range-value" id="rateValue">1.0</span></div>
        </div>
        <div class="settings-item">
          <label for="pitch">Cao ƒë·ªô</label>
          <div class="range-container"><input type="range" id="pitch" min="0.5" max="2" step="0.1" value="1"><span class="range-value" id="pitchValue">1.0</span></div>
        </div>
      </div>
    </div>

    <div class="section recordings">
      <h2 class="section-heading">B·∫£n ghi g·∫ßn ƒë√¢y</h2>
      <p style="font-size:.9em;color:#888;margin-top:-10px">L∆∞u c·ª•c b·ªô trong phi√™n n√†y. B·∫°n c√≥ th·ªÉ t·∫£i v·ªÅ.</p>
      <div id="recordingList"></div>
    </div>
  </div>

  <script>
    // ====== d·ªØ li·ªáu c√¢u h·ªèi (GI·ªÆ NGUY√äN N·ªòI DUNG C·ª¶A B·∫†N) ======
    const questionsData = {
      "Giao ti·∫øp h√†ng ng√†y": [
        {question:"What did you do on your last holiday?",answer:"On my last holiday, I went to a beautiful beach with my family. We swam, built sandcastles, and ate a lot of fresh seafood. It was very relaxing and fun."},
        {question:"How do you usually get to work or school?",answer:"I usually take the bus to work. It's convenient and helps me avoid traffic. Sometimes, I ride my bicycle if the weather is nice."},
        {question:"What is your favorite hobby and why?",answer:"My favorite hobby is reading because it helps me relax and learn new things. I especially enjoy reading historical fiction."},
        {question:"Tell me about a typical day in your life.",answer:"A typical day for me starts with waking up early to exercise, then I go to work. In the evening, I cook dinner and spend some time relaxing by watching a movie or reading a book before bed."},
        {question:"What is your favorite type of food and why?",answer:"My favorite food is Vietnamese pho. I love the rich broth and fresh ingredients. It's a comforting and flavorful dish that reminds me of home."}
      ],
      "Kinh doanh & C√¥ng vi·ªác": [
        {question:"Describe a challenge you faced at work and how you overcame it.",answer:"I once had a tight deadline on a project with an incomplete team. I organized a brief meeting, delegated tasks based on individual strengths, and worked extra hours to ensure we finished on time and the quality was high."},
        {question:"What are your professional goals for the next five years?",answer:"My goal is to develop my skills in project management and take on more leadership responsibilities. I also plan to pursue a professional certification to advance my career in this field."},
        {question:"How do you handle stress and pressure in the workplace?",answer:"I manage stress by prioritizing my tasks and focusing on one thing at a time. I also take short breaks to clear my mind and practice mindfulness to stay calm and focused."},
        {question:"Describe a time you had to work with a difficult coworker.",answer:"I had a project with a coworker who had a different working style. Instead of getting frustrated, I initiated a conversation to understand their perspective. We found common ground and successfully completed the project by combining our strengths."},
        {question:"What motivates you to do your best work?",answer:"I am motivated by a sense of accomplishment and the opportunity to learn new things. I also feel a strong drive to contribute to my team's success and help the company achieve its goals."}
      ],
      "S·ªü th√≠ch & Phong c√°ch s·ªëng": [
        {question:"Do you prefer listening to music or podcasts? Why?",answer:"I prefer listening to podcasts because they are a great way to learn new things while commuting or exercising. I'm especially interested in podcasts about technology and entrepreneurship."},
        {question:"What kind of books do you enjoy reading?",answer:"I enjoy reading a variety of genres, but I'm most drawn to science fiction and fantasy. I love how these stories allow me to escape into different worlds and explore new ideas."},
        {question:"How do you spend your weekends?",answer:"On the weekends, I like to relax and spend time with my family and friends. We often go hiking in the mountains or have a barbecue in the park. Sometimes I just stay home and catch up on my favorite TV shows."},
        {question:"What is your favorite movie or TV show and why?",answer:"My favorite TV show is 'The Office'. I love the humor and the witty dialogues. It's a feel-good show that always makes me laugh and helps me unwind after a long day."},
        {question:"If you could travel anywhere in the world, where would you go and why?",answer:"I would travel to Japan. I am fascinated by its rich culture, beautiful temples, and delicious food. I would love to experience the cherry blossom season and explore the bustling streets of Tokyo."}
      ]
    };

    // ====== KH·ªûI T·∫†O UI ======
    function populateUI(){
      const topicSelect=document.getElementById('topicSelect');
      topicSelect.innerHTML='';
      Object.keys(questionsData).forEach(t=>{const o=document.createElement('option');o.value=t;o.textContent=t;topicSelect.appendChild(o)});
      topicSelect.addEventListener('change',()=>{buildQuestionSelect();applySelectedQuestion()});
      document.getElementById('questionSelect').addEventListener('change',applySelectedQuestion);
      document.getElementById('loadQuestion').addEventListener('click',loadRandomQuestion);
      // L·∫ßn ƒë·∫ßu
      buildQuestionSelect();
      applySelectedQuestion();
    }

    // T·∫°o danh s√°ch <option> cho select c√¢u h·ªèi (c√≥ m≈©i t√™n)
    function buildQuestionSelect(){
      const topic=document.getElementById('topicSelect').value;
      const qs=questionsData[topic]||[];
      const sel=document.getElementById('questionSelect');
      sel.innerHTML='';
      qs.forEach((item,idx)=>{const op=document.createElement('option');op.value=String(idx);op.textContent=`${idx+1}. ${item.question}`;sel.appendChild(op)});
      // Gi·ªØ ch·ªçn ph·∫ßn t·ª≠ ƒë·∫ßu n·∫øu t·ªìn t·∫°i
      if(qs.length>0) sel.value='0';
    }

    // √Åp d·ª•ng c√¢u h·ªèi theo option ƒëang ch·ªçn
    function applySelectedQuestion(){
      const topic=document.getElementById('topicSelect').value;
      const qs=questionsData[topic]||[];
      const selIdx=parseInt(document.getElementById('questionSelect').value||'0',10)||0;
      const item=qs[Math.min(Math.max(selIdx,0),Math.max(qs.length-1,0))];
      if(!item) return;
      document.getElementById('question').value=item.question;
      document.getElementById('suggestedAnswer').value=item.answer;
    }

    // L·∫•y ng·∫´u nhi√™n nh∆∞ng v·∫´n c·∫≠p nh·∫≠t select ƒë·ªÉ ƒë·ªìng b·ªô
    function loadRandomQuestion(){
      const topic=document.getElementById('topicSelect').value;
      const qs=questionsData[topic]||[];
      if(!qs.length) return;
      const idx=Math.floor(Math.random()*qs.length);
      document.getElementById('questionSelect').value=String(idx);
      applySelectedQuestion();
    }

    document.addEventListener('DOMContentLoaded', populateUI);

    // ====== TTS ======
    const synth=window.speechSynthesis; let voices=[];
    function populateVoiceList(){
      voices=synth.getVoices();
      const voiceSelect=document.getElementById('voiceSelect');
      voiceSelect.innerHTML='';
      voices.forEach(v=>{if(v.lang.startsWith('en')){const op=document.createElement('option');op.value=v.name;op.textContent=`${v.name} (${v.lang})`;voiceSelect.appendChild(op);}});
      const def=voices.find(v=>v.lang==='en-US'); if(def) voiceSelect.value=def.name;
    }
    populateVoiceList(); if(synth.onvoiceschanged!==undefined) synth.onvoiceschanged=populateVoiceList;
    document.getElementById('rate').addEventListener('input',e=>document.getElementById('rateValue').textContent=e.target.value);
    document.getElementById('pitch').addEventListener('input',e=>document.getElementById('pitchValue').textContent=e.target.value);
    function speak(text){const u=new SpeechSynthesisUtterance(text);const sel=document.getElementById('voiceSelect').value;const v=voices.find(v=>v.name===sel);if(v)u.voice=v;u.rate=parseFloat(document.getElementById('rate').value);u.pitch=parseFloat(document.getElementById('pitch').value);synth.speak(u);}
    document.getElementById('playQuestion').addEventListener('click',()=>speak(document.getElementById('question').value));
    document.getElementById('playSuggested').addEventListener('click',()=>speak(document.getElementById('suggestedAnswer').value));

    // ====== Ghi √¢m + transcript (gi·ªØ nguy√™n logic c≈©) ======
    let recognition; let mediaRecorder; let audioChunks=[]; let recordings=[]; let currentAudio=null; let timerInterval; let timeLeft=30; const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;

    document.getElementById('startRecording').addEventListener('click', async()=>{
      try{
        const stream=await navigator.mediaDevices.getUserMedia({audio:true});
        mediaRecorder=new MediaRecorder(stream); audioChunks=[];
        mediaRecorder.ondataavailable=e=>audioChunks.push(e.data);
        mediaRecorder.onstop=()=>{const blob=new Blob(audioChunks,{type:'audio/webm'});recordings.push(blob);updateRecordingList();};
        mediaRecorder.start();
        document.getElementById('startRecording').disabled=true;document.getElementById('stopRecording').disabled=false;
        timeLeft=30; document.getElementById('timer').textContent='00:30'; timerInterval=setInterval(updateTimer,1000);
        if(SpeechRecognition){
          recognition=new SpeechRecognition(); recognition.lang='en-US'; recognition.interimResults=true;
          recognition.onresult=e=>{const t=Array.from(e.results).map(r=>r[0].transcript).join(''); document.getElementById('transcript').value=t;};
          recognition.onerror=e=>console.error('Speech recognition error',e);
          recognition.start();
        }
      }catch(err){console.error('Error accessing microphone',err); alert('Kh√¥ng th·ªÉ truy c·∫≠p microphone. Vui l√≤ng ki·ªÉm tra quy·ªÅn v√† th·ª≠ l·∫°i.');}
    });

    document.getElementById('stopRecording').addEventListener('click',()=>{
      if(mediaRecorder&&mediaRecorder.state!=='inactive') mediaRecorder.stop();
      if(recognition) recognition.stop();
      clearInterval(timerInterval);
      document.getElementById('startRecording').disabled=false;document.getElementById('stopRecording').disabled=true;
    });

    document.getElementById('clearTranscript').addEventListener('click',()=>document.getElementById('transcript').value='');
    document.getElementById('playLastRecording').addEventListener('click',()=>{
      if(recordings.length>0){const last=recordings[recordings.length-1]; if(currentAudio) currentAudio.pause(); currentAudio=new Audio(URL.createObjectURL(last)); currentAudio.play();} else {alert('Ch∆∞a c√≥ b·∫£n ghi n√†o.');}
    });

    function updateTimer(){ timeLeft--; document.getElementById('timer').textContent=`00:${timeLeft.toString().padStart(2,'0')}`; if(timeLeft<=0 && !document.getElementById('stopRecording').disabled){ document.getElementById('stopRecording').click(); } }

    function updateRecordingList(){ const list=document.getElementById('recordingList'); list.innerHTML=''; recordings.forEach((blob,i)=>{const div=document.createElement('div'); div.className='recording-item'; const audio=document.createElement('audio'); audio.controls=true; audio.src=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=audio.src; a.download=`recording_${i+1}.webm`; a.textContent='T·∫£i v·ªÅ'; div.appendChild(audio); div.appendChild(a); list.appendChild(div); }); }
  </script>
</body>
</html>
